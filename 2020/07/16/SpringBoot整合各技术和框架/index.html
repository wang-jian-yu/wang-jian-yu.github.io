<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringBoot整合各技术和框架 | Wang</title><meta name="description" content="SpringBoot整合各技术和框架Springboot与缓存缓存的概念  缓存就是数据交换的缓冲区（称作：Cache），当某一硬件要读取数据时，会首先从缓存汇总查询数据，有则直接执行，不存在时从内存中获取。由于缓存的数据比内存快的多，所以缓存的作用就是帮助硬件更快的运行。 缓存往往使用的是RAM（断电既掉的非永久存储），所以在用完后还是会把文件送到硬盘等存储器中永久存储。电脑中最大缓存就是内存条"><meta name="keywords" content="springboot"><meta name="author" content="小小王,1442243445@qq.com"><meta name="copyright" content="小小王"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/Banq-1.ico"><link rel="canonical" href="http://yoursite.com/2020/07/16/SpringBoot%E6%95%B4%E5%90%88%E5%90%84%E6%8A%80%E6%9C%AF%E5%92%8C%E6%A1%86%E6%9E%B6/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot整合各技术和框架"><meta property="og:url" content="http://yoursite.com/2020/07/16/SpringBoot%E6%95%B4%E5%90%88%E5%90%84%E6%8A%80%E6%9C%AF%E5%92%8C%E6%A1%86%E6%9E%B6/"><meta property="og:site_name" content="Wang"><meta property="og:description" content="SpringBoot整合各技术和框架Springboot与缓存缓存的概念  缓存就是数据交换的缓冲区（称作：Cache），当某一硬件要读取数据时，会首先从缓存汇总查询数据，有则直接执行，不存在时从内存中获取。由于缓存的数据比内存快的多，所以缓存的作用就是帮助硬件更快的运行。 缓存往往使用的是RAM（断电既掉的非永久存储），所以在用完后还是会把文件送到硬盘等存储器中永久存储。电脑中最大缓存就是内存条"><meta property="og:image" content="http://yoursite.com/img/bg3.jpg"><meta property="article:published_time" content="2020-07-16T01:28:24.000Z"><meta property="article:modified_time" content="2020-07-16T05:58:50.566Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="SpringCloud Stream 消息驱动" href="http://yoursite.com/2020/07/16/SpringCloud%20Stream%20%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"><link rel="next" title="SpringCloudSleuth分布式请求链路跟踪" href="http://yoursite.com/2020/07/16/SpringCloudSleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="/css/move_mouse/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/iconfont.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/pool.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">26</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot整合各技术和框架"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot整合各技术和框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot与缓存"><span class="toc-number">1.1.</span> <span class="toc-text">Springboot与缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存的概念"><span class="toc-number">1.1.1.</span> <span class="toc-text">缓存的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#缓存在不同的场景下，作用是不一样的具体举例说明："><span class="toc-number">1.1.1.0.0.1.</span> <span class="toc-text">缓存在不同的场景下，作用是不一样的具体举例说明：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一、JSR"><span class="toc-number">1.1.2.</span> <span class="toc-text">一、JSR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-Caching定义了5个核心接口"><span class="toc-number">1.1.3.</span> <span class="toc-text">Java Caching定义了5个核心接口</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#●-CachingProvider"><span class="toc-number">1.1.3.0.0.1.</span> <span class="toc-text">● CachingProvider</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#●-CacheManager"><span class="toc-number">1.1.3.0.0.2.</span> <span class="toc-text">● CacheManager</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#●-Cache"><span class="toc-number">1.1.3.0.0.3.</span> <span class="toc-text">● Cache</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#●-Entry"><span class="toc-number">1.1.3.0.0.4.</span> <span class="toc-text">● Entry</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#●-Expiry"><span class="toc-number">1.1.3.0.0.5.</span> <span class="toc-text">● Expiry</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、Spring的缓存抽象"><span class="toc-number">1.1.4.</span> <span class="toc-text">二、Spring的缓存抽象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、缓存注解-amp-几个重要概念"><span class="toc-number">1.2.</span> <span class="toc-text">三、缓存注解&amp;几个重要概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#四、缓存的使用"><span class="toc-number">1.2.1.</span> <span class="toc-text">四、缓存的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-搭建基本环境"><span class="toc-number">1.2.1.0.1.</span> <span class="toc-text">1. 搭建基本环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-引入缓存"><span class="toc-number">1.2.1.0.2.</span> <span class="toc-text">2.引入缓存</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-快速体验缓存"><span class="toc-number">1.2.1.0.3.</span> <span class="toc-text">3.快速体验缓存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、整合redis作为缓存"><span class="toc-number">1.2.2.</span> <span class="toc-text">五、整合redis作为缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、缓存工作原理"><span class="toc-number">1.2.3.</span> <span class="toc-text">五、缓存工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#核心："><span class="toc-number">1.2.3.0.0.1.</span> <span class="toc-text">核心：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot与消息"><span class="toc-number">1.3.</span> <span class="toc-text">Springboot与消息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、消息的简介"><span class="toc-number">1.3.1.</span> <span class="toc-text">一、消息的简介</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-消息服务的两个重要概念"><span class="toc-number">1.3.1.0.1.</span> <span class="toc-text">1. 消息服务的两个重要概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-消息的代理规范"><span class="toc-number">1.3.1.0.2.</span> <span class="toc-text">2. 消息的代理规范</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-作用"><span class="toc-number">1.3.1.0.3.</span> <span class="toc-text">3. 作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4场景"><span class="toc-number">1.3.1.0.4.</span> <span class="toc-text">4.4场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、RabbitMQ"><span class="toc-number">1.3.2.</span> <span class="toc-text">二、RabbitMQ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot与分布式"><span class="toc-number">1.4.</span> <span class="toc-text">Spring Boot与分布式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、分布式应用"><span class="toc-number">1.4.1.</span> <span class="toc-text">一、分布式应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、Zookeeper和Dubbo"><span class="toc-number">1.4.2.</span> <span class="toc-text">二、Zookeeper和Dubbo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、Zookeeper和Dubbo简单使用"><span class="toc-number">1.4.3.</span> <span class="toc-text">三、Zookeeper和Dubbo简单使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、Spring-Boot和Spring-Cloud"><span class="toc-number">1.4.4.</span> <span class="toc-text">三、Spring Boot和Spring Cloud</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Spring-Cloud-入门"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">1. Spring Cloud 入门</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot与监控管理"><span class="toc-number">1.5.</span> <span class="toc-text">Spring Boot与监控管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、监控管理"><span class="toc-number">1.5.1.</span> <span class="toc-text">一、监控管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、定制端点信息"><span class="toc-number">1.5.2.</span> <span class="toc-text">二、定制端点信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#40、自定义HealthIndicator"><span class="toc-number">1.5.2.0.0.1.</span> <span class="toc-text">40、自定义HealthIndicator</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/bg3.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Wang</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">SpringBoot整合各技术和框架</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-16 09:28:24"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-07-16</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-16 13:58:50"><i class="fas fa-history fa-fw"></i> 更新于 2020-07-16</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/springboot/">springboot</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="SpringBoot整合各技术和框架"><a href="#SpringBoot整合各技术和框架" class="headerlink" title="SpringBoot整合各技术和框架"></a>SpringBoot整合各技术和框架</h1><h2 id="Springboot与缓存"><a href="#Springboot与缓存" class="headerlink" title="Springboot与缓存"></a>Springboot与缓存</h2><h3 id="缓存的概念"><a href="#缓存的概念" class="headerlink" title="缓存的概念"></a>缓存的概念</h3><blockquote>
<ol>
<li>缓存就是数据交换的缓冲区（称作：Cache），当某一硬件要读取数据时，会首先从缓存汇<br>总查询数据，有则直接执行，不存在时从内存中获取。由于缓存的数据比内存快的多，所以<br>缓存的作用就是帮助硬件更快的运行。</li>
<li>缓存往往使用的是RAM（断电既掉的非永久存储），所以在用完后还是会把文件送到硬盘等<br>存储器中永久存储。电脑中最大缓存就是内存条，硬盘上也有16M或者32M的缓存。</li>
<li>高速缓存是用来协调CPU与主存之间存取速度的差异而设置的。一般CPU工作速度高，但内<br>存的工作速度相对较低，为了解决这个问题，通常使用高速缓存，高速缓存的存取速度介于<br>CPU与主存之间。系统将一些CPU在最近几个时间段经常访问的内容存在高速缓存，这样就<br>在一定程度上缓解了由于主存速度低造成的CPU“停工待料”的情况。</li>
<li>缓存就是把一些外存上的数据保存在内存上而已，为什么保存在内存上，我们运行的所有程<br>序里面的变量都是存放在内存中的，所以如果想将值放入内存上，可以通过变量的方式存<br>储。在JAVA中一些缓存一般都是通过Map集合来实现的。</li>
</ol>
</blockquote>
<h6 id="缓存在不同的场景下，作用是不一样的具体举例说明："><a href="#缓存在不同的场景下，作用是不一样的具体举例说明：" class="headerlink" title="缓存在不同的场景下，作用是不一样的具体举例说明："></a>缓存在不同的场景下，作用是不一样的具体举例说明：</h6><ul>
<li>操作系统磁盘缓存 ——&gt; 减少磁盘机械操作。</li>
<li>数据库缓存——&gt;减少文件系统IO。</li>
<li>应用程序缓存——&gt;减少对数据库的查询。</li>
<li>Web服务器缓存——&gt;减少应用服务器请求。</li>
<li>客户端浏览器缓存——&gt;减少对网站的访问。</li>
</ul>
<h3 id="一、JSR"><a href="#一、JSR" class="headerlink" title="一、JSR"></a>一、JSR</h3><p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200612105200111.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="Java-Caching定义了5个核心接口"><a href="#Java-Caching定义了5个核心接口" class="headerlink" title="Java Caching定义了5个核心接口"></a>Java Caching定义了5个核心接口</h3><h6 id="●-CachingProvider"><a href="#●-CachingProvider" class="headerlink" title="● CachingProvider"></a>● CachingProvider</h6><p>定义了创建、配置、获取、管理和控制多个CacheManager。一个应用可 以在运行期访问多个CachingProvider。   </p>
<h6 id="●-CacheManager"><a href="#●-CacheManager" class="headerlink" title="● CacheManager"></a>● CacheManager</h6><p>定义了创建、配置、获取、管理和控制多个唯一命名的Cache，这些Cache 存在于CacheManager的上下文中。一个CacheManager仅被一个CachingProvider所拥有。</p>
<h6 id="●-Cache"><a href="#●-Cache" class="headerlink" title="● Cache"></a>● Cache</h6><p>一个类似Map的数据结构并临时存储以Key为索引的值。一个Cache仅被一个 CacheManager所拥有。</p>
<h6 id="●-Entry"><a href="#●-Entry" class="headerlink" title="● Entry"></a>● Entry</h6><p>一个存储在Cache中的key-value对。</p>
<h6 id="●-Expiry"><a href="#●-Expiry" class="headerlink" title="● Expiry"></a>● Expiry</h6><p>每一个存储在Cache中的条目有一个定义的有效期。一旦超过这个时间，条目为过期的状态。一旦 过期，条目将不可访问、更新和删除。缓存有效期可以通过ExpiryPolicy设置。</p>
<h3 id="二、Spring的缓存抽象"><a href="#二、Spring的缓存抽象" class="headerlink" title="二、Spring的缓存抽象"></a>二、Spring的缓存抽象</h3><p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200612105809608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li>Spring从3.1开始定义了==org.springframework.cache.Cache== 和==org.springframework.cache.CacheManage==r接口来统一不同的缓存技术； 并支持使用JCache（JSR-107）注解简化我们开发； Cache接口有以下功能： 为缓存的组件规范定义，包含缓存的各种操作集合；</li>
<li>Spring提供了各种xxxCache的实现；如RedisCache，EhCacheCache , ConcurrentMapCache等；<h2 id="三、缓存注解-amp-几个重要概念"><a href="#三、缓存注解-amp-几个重要概念" class="headerlink" title="三、缓存注解&amp;几个重要概念"></a>三、缓存注解&amp;几个重要概念</h2><table>
<thead>
<tr>
<th>注解名/概念名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Cache</td>
<td>缓存接口，定义缓存操作。实现（不同的实现相当于不同的缓存技术）有： RedisCache、EhCacheCache、ConcueerntMapCache等</td>
</tr>
<tr>
<td>CacheManager</td>
<td>缓存管理器，管理各种缓存（Cache）组件</td>
</tr>
<tr>
<td>@Cacheable</td>
<td>主要针对方法配置，能够根据方法的请求参数对其结果进行缓存（添加缓 存）</td>
</tr>
<tr>
<td>@CacheEvict 清空缓存</td>
<td>（删除缓存）</td>
</tr>
<tr>
<td>@CachePut</td>
<td>保证方法被调用，又希望结果被缓存（更新缓存）</td>
</tr>
<tr>
<td>@EnableCaching</td>
<td>开启基于注解的缓存（使用上方三个缓存注解必须先写上该注解）</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>缓存数据时key生成策略</td>
</tr>
<tr>
<td>serialize</td>
<td>缓存数据时value序列化策略</td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong>SpEL表达式</strong><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200612111130850.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>  <strong>@Cacheable、@CachePut、@CacheEvict 的基本参数</strong></p>
<ul>
<li><strong>cacheNames / value</strong><br>缓存的名称，在 spring 配置文件中定义，必须指定 至少一个 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例如：</span></span><br><span class="line"><span class="meta">@Cacheable</span>(cacheNames=<span class="string">"mycache"</span>) </span><br><span class="line"><span class="meta">@Cacheable</span>(cacheNames=&#123;<span class="string">"cache1"</span>,<span class="string">"cache2"</span>&#125;)</span><br><span class="line"><span class="comment">//或者 </span></span><br><span class="line"><span class="meta">@Cacheable</span>(value=<span class="string">"mycache"</span>) </span><br><span class="line"><span class="meta">@Cacheable</span>(value=&#123;<span class="string">"cache1"</span>,<span class="string">"cache2"</span>&#125;)</span><br></pre></td></tr></table></figure></li>
<li><strong>key</strong><br>缓存的 key，可以为空，如果指定要按照 SpEL 表达 式编写，如果不指定，则缺省按照方法的所有参数 进行组合  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//eg1： </span></span><br><span class="line"><span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#id"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmp</span><span class="params">(Integer id)</span></span>&#123;...&#125;<span class="comment">//缓存的key为id的值</span></span><br><span class="line"><span class="comment">//eg2：</span></span><br><span class="line"> <span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#root.methodName + '[' + #id + ']'"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmp</span><span class="params">(Integer id)</span></span>&#123;...&#125;<span class="comment">//缓存的key为字符串"getEmp(id的值)"</span></span><br></pre></td></tr></table></figure></li>
<li><strong>keyGenerator</strong><br>key的生成器；可以自己指定key生成器的组件id。<br>==注==：key和keyGenerator为==二选一==<ul>
<li><strong>自定义keyGenerator</strong><br>编写conﬁg类 –&gt; 创建返回一个KeyGenerator类型的方法（假定该方法起名为myKeyGenerator） –&gt; 实现KeyGenerator，通过编写generate方法自定义返回的key的格式 –&gt; 把myKeyGenerator() 加到容器</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">//config.MyCacheConfig</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCacheConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"myKeyGenerator"</span>)<span class="comment">//默认是方法名   </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KeyGenerator <span class="title">keyGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//包名为org.springframework.cache.interceptor.KeyGenerator        </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KeyGenerator() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object target, Method method, Object... params)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//相当于 key = "#root.methodName + '[' + #id + ']'" </span></span><br><span class="line">                <span class="keyword">return</span> method.getName() + <span class="string">"["</span> + Arrays.asList(params) + <span class="string">"]"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//service.EmployeeService </span></span><br><span class="line"><span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,keyGenerator = <span class="string">"myKeyGenerator"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmp</span><span class="params">(Integer id)</span></span>&#123;...&#125;</span><br><span class="line"> <span class="comment">//缓存的key为字符串"getEmp(id的值)"，</span></span><br><span class="line"> <span class="comment">// 即为自定义的keyGenerator的返回内容</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>cacheManager：</strong><br>指定缓存管理器（指定缓存技术） 或者使用cacheResolver指定获取解析器<br>注：==cacheManager和cacheResolver为二选一==</li>
<li><strong>condition</strong><br>缓存的条件，可以为空，使用 SpEL 编写，返回 true 或者 false，只有为 true 才进行缓存/清除缓存，在 调用方法之前之后都能判断 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例如： </span></span><br><span class="line">@Cacheable(value=”testcache”,condition=”#userNam e.length()&gt;2”)</span><br></pre></td></tr></table></figure></li>
<li><strong>allEntries (@CacheEvict )</strong><br>是否清空所有缓存内容，缺省为 false，如果指定为 true，则方法调用后将立即清空所有缓存 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//例如： </span></span><br><span class="line">  <span class="meta">@CachEvict</span>(value=”testcache”,allEntries=<span class="keyword">true</span>)</span><br><span class="line">* **beforeInvocation (<span class="meta">@CacheEvict</span>)**  </span><br><span class="line">  是否在方法执行前就清空，缺省为 <span class="keyword">false</span>，如果指定 为 <span class="keyword">true</span>，则在方法还没有执行的时候就清空缓存， 缺省情况下，如果方法执行抛出异常，则不会清空 缓存  </span><br><span class="line">​```java</span><br><span class="line"> <span class="comment">// 例如：</span></span><br><span class="line">  <span class="meta">@CachEvict</span>(value=”testcache”， beforeInvocation=<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure></li>
<li><strong>unless (@CachePut) (@Cacheable)</strong><br>用于否决缓存的，不像condition，该表达式只在方 法执行之后判断，此时可以拿到返回值result进行判 断。条件为true不会缓存，fasle才缓存 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例如：</span></span><br><span class="line"> @Cacheable(value=”testcache”,unless=”#result == null”)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>sync</strong><br>是否使用异步模式</li>
</ul>
</li>
</ul>
<h3 id="四、缓存的使用"><a href="#四、缓存的使用" class="headerlink" title="四、缓存的使用"></a>四、缓存的使用</h3><h5 id="1-搭建基本环境"><a href="#1-搭建基本环境" class="headerlink" title="1. 搭建基本环境"></a>1. 搭建基本环境</h5><ol>
<li>导入数据库文件，创建出department和employee表 </li>
<li>创建JavaBean（entity层）封装数据 </li>
<li>整合Mybatis操作数据库 </li>
</ol>
<ul>
<li>配置数据源</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jdbc连接配置 </span></span><br><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">datasource:</span>   </span><br><span class="line"> 	<span class="attr">username:</span> <span class="string">root</span>   </span><br><span class="line"> 	<span class="attr">password:</span> <span class="string">root</span>   </span><br><span class="line"> 	<span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.17.131:3306/mybatis</span> <span class="string">。</span></span><br><span class="line"> 	<span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#开启驼峰命名 </span></span><br><span class="line"><span class="attr">mybatis:</span> </span><br><span class="line"> <span class="attr">configuration:</span>  </span><br><span class="line">   <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#获取"person.simon.springboot.mapper"包下的日志记录 </span></span><br><span class="line"><span class="attr">logging:</span> </span><br><span class="line"> <span class="attr">level:</span>  </span><br><span class="line">   <span class="attr">person.simon.springboot.mapper:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>使用注解版MyBatis </li>
</ol>
<ul>
<li>@MapperScan指定需要扫描的mapper接口所在的包 </li>
<li>编辑mapper </li>
<li>编写service（mapper自动驻入后标红可在mapper加@Repository注解） 在service写上一个标识sout(“查询” + id + “号员工”)；方便查看是否动用数据库查询 <h5 id="2-引入缓存"><a href="#2-引入缓存" class="headerlink" title="2.引入缓存"></a>2.引入缓存</h5></li>
</ul>
<ol>
<li>导入依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>   </span><br><span class="line"> 	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">	 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>开启缓存 ：在主类上使用@EnableCaching注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"persion.springboot_cache.mapper"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">//开启注解缓存</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootCacheApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootCacheApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-快速体验缓存"><a href="#3-快速体验缓存" class="headerlink" title="3.快速体验缓存"></a>3.快速体验缓存</h5><ul>
<li>在service层的方法添加对应注解即可 </li>
</ul>
<ol>
<li><strong>@Cacheable</strong>（增加数据进缓存——先查找key对应的缓存，若没有再调用方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#id"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"查询"</span>+id+<span class="string">"号员工："</span>);</span><br><span class="line">       <span class="keyword">return</span>  employeeMapper.getEmpById(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>==注意：不能用#result进行key的编写，因为是先查找key再调用方法的，查找key时没有方法的返 回值==<br>2. <strong>@CacheEvict</strong> （删除某个或所有缓存）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除key为id的缓存</span></span><br><span class="line"> <span class="meta">@CacheEvict</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delEmpById</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"已经删除缓存"</span>+id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除emp缓存的所有缓存 </span></span><br><span class="line"><span class="comment">/* allEntries = true：指定清除该缓存所有数据 beforeInvocation：</span></span><br><span class="line"><span class="comment">缓存的清除是否在方法之前执行（true：在方法之前；</span></span><br><span class="line"><span class="comment">false：在方法之 后执行。默认为false。） */</span> </span><br><span class="line"><span class="meta">@CacheEvict</span>(value = <span class="string">"emp"</span>,allEntries = <span class="keyword">true</span>,beforeInvocation = <span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">delAllEmp</span><span class="params">()</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>@CachePut</strong> （更新数据进缓存——先调用方法再更改缓存数据）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#employee.id"</span> ) </span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">updateEmp</span><span class="params">(Employee employee)</span> </span>&#123;    </span><br><span class="line">	System.out.println(<span class="string">"更新员工"</span>+employee);    </span><br><span class="line">	employeeMapper.updateEmp(employee);   </span><br><span class="line">	<span class="keyword">return</span> employee; </span><br><span class="line">	 &#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：要注意保持@Cacheable和CachePut保存到缓存中的key相同</strong><br> eg. ：因为updateEmp(Employee employee)的参数是Employee employee，所以这里如果省略 key的话，修改的则是key为Employee employee的缓存。而上方@Cacheable的key是id，所以会 出现虽然数据库更新了，但使用缓存显示出来的值仍是仍未修改的key为id的值。所以上方要 写”#employee.id”与@Cacheable的key的值保持一致，才能正确修改缓存。</p>
<ol start="4">
<li><strong>@Caching</strong> （定义复杂的缓存规则）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Caching源码 </span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;) </span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Inherited</span> <span class="meta">@Documented</span></span><br><span class="line"> <span class="keyword">public</span> <span class="meta">@interface</span> Caching &#123;   </span><br><span class="line">   Cacheable[] cacheable() <span class="keyword">default</span> &#123;&#125;; </span><br><span class="line">   CachePut[] put() <span class="keyword">default</span> &#123;&#125;;  </span><br><span class="line">   CacheEvict[] evict() <span class="keyword">default</span> &#123;&#125;; </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Caching</span>(</span><br><span class="line"> 		<span class="comment">//先查找key：#｛lastName｝，若没有再调用方法 </span></span><br><span class="line">        cacheable = &#123;</span><br><span class="line">                <span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#lastName"</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">         <span class="comment">//先调用方法，再根据key：id和email查找缓存区并存储</span></span><br><span class="line">        put = &#123;</span><br><span class="line">                <span class="meta">@CachePut</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#id"</span>),</span><br><span class="line">                <span class="meta">@CachePut</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#result.email"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByLastName</span><span class="params">(String lastName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  employeeMapper.getEmpByLastName(lastName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然通过@Caching组合了三个缓存规则，实际上后也以lastName、id、email这三个数据为key 存储了缓存。 但是当你用lastName来查询员工时，仍要访问数据库。这是因为组合规则中有put的存在，而put 的特点是：无论缓存区中是否存在key，都是先调用方法再进行查找并存储。</p>
<ol start="5">
<li><strong>@CacheConﬁg</strong>（抽取缓存的公共配置）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在类头加，加了方法前这个写</span></span><br><span class="line"><span class="meta">@CacheConfig</span>(cacheNames = <span class="string">"emp"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeService</span> </span>&#123; </span><br><span class="line"><span class="comment">//不加@CacheConfig</span></span><br><span class="line"> <span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#&#123;id&#125;"</span>) </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>&#123;...&#125;</span><br><span class="line">  <span class="comment">//加@CacheConfig</span></span><br><span class="line"> <span class="meta">@Cacheable</span>(key = <span class="string">"#&#123;id&#125;"</span>) </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="五、整合redis作为缓存"><a href="#五、整合redis作为缓存" class="headerlink" title="五、整合redis作为缓存"></a>五、整合redis作为缓存</h3><p>Springboot默认使用的是ConcurrentMapCacheManeger == ConcurrentMapCache；将数据保存在 ConcurrentMap&lt;Object,Object&gt;中 实际开发中我们经常会使用缓存中间站，例如redis、memcached、ehcache等。 </p>
<ol>
<li><strong>安装redis</strong>（使用docker）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//拉取</span><br><span class="line">docker docker pull redis</span><br><span class="line">//启动一个docker实例 </span><br><span class="line">//-d：后台启动   -p：暴露端口   --name：命名  </span><br><span class="line">// a4d3716dbb72：容器id，通过输入docker </span><br><span class="line">images查看 </span><br><span class="line">docker run -d -p 6379:6379 --name myredis a4d3716dbb72</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>可以下载redis界面化工具进行测试和使用</li>
<li>基本操作可通过<a href="http://www.redis.cn/" target="_blank" rel="noopener">官网</a>进行文档查看学习 </li>
</ul>
<ol start="2">
<li><strong>引入redis的starter</strong> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-dataredis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>*<em>配置redis *</em></li>
</ol>
<ul>
<li>在配置文件 application.properties 或 application.yml 中指定redis的主机地址</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>    </span><br><span class="line">  <span class="attr">redis:</span>      </span><br><span class="line"> 	 <span class="attr">host:</span> <span class="number">132.168</span><span class="number">.1</span><span class="number">.123</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>RedisTemplate</strong><blockquote>
<p>  RedisAutoConﬁguration向容器中导入了两个组件：<br>  RedisTemplate&lt;Object, Object&gt; redisTemplate()<br>  StringRedisTemplate stringRedisTemplate()</p>
</blockquote>
</li>
</ol>
<p>使用时只需自动注入即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//操作k-v都是对象的</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">//操作k-v都是字符串的</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> StringRedisTemplate stringRedisTemplate;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Redis 常见的五大数据类型</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="right">对应的操作</th>
</tr>
</thead>
<tbody><tr>
<td align="center">String（字符串）</td>
<td align="right">stringRedisTemplate.opsForValue()//用来操作String（字符串）</td>
</tr>
<tr>
<td align="center">List（列表）</td>
<td align="right">stringRedisTemplate.opsForList()//用来操作List（列表）</td>
</tr>
<tr>
<td align="center">Set（集合）</td>
<td align="right">stringRedisTemplate.opsForSet()//用来操作Set（集合）</td>
</tr>
<tr>
<td align="center">Hash（散列）</td>
<td align="right">stringRedisTemplate.opsForHash()//用来操作Hash（散列）</td>
</tr>
<tr>
<td align="center">ZSet（有序集合）</td>
<td align="right">stringRedisTemplate.opsForZSet()//用来操作ZSet（有序集合）</td>
</tr>
<tr>
<td align="center">5. <strong>使用redis</strong></td>
<td align="right"></td>
</tr>
<tr>
<td align="center">*  在导入redis依赖后，selectimports()方法就不再默认生效SimpleCacheConﬁguration了，而是生 效RedisCacheConﬁguration类，然后创建RedisCacheManager，并对应使用RedisCache来进行缓存 数据。</td>
<td align="right"></td>
</tr>
<tr>
<td align="center">*   redis缓存的对象默认是要一个序列化的数据，为此，我们可以把要缓存的对象去实现Serializable 接口，使之变成jdk序列化数据，如：</td>
<td align="right"></td>
</tr>
<tr>
<td align="center"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entity.Employee.class </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure></td>
<td align="right"></td>
</tr>
<tr>
<td align="center">*  序列化后的数据存入缓存结果如下：</td>
<td align="right"></td>
</tr>
<tr>
<td align="center"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k:<span class="string">"emp::1"</span> </span><br><span class="line">v:\x00~\x00\x05sr\x00$person.simon.springboot.entity.Employeeuqf\x03p\x9A\xCF </span><br><span class="line">\xE0\x02\x00\x05L\x00\x03dIdt\x00\x13Ljava/lang/Integer;L\x00\x05emailt</span><br></pre></td></tr></table></figure></td>
<td align="right"></td>
</tr>
<tr>
<td align="center">* 若想将数据以json的方式保存</td>
<td align="right"></td>
</tr>
</tbody></table>
<ol>
<li>自己将对象转为json  </li>
<li>改变redisTemplate默认的序列化规则，更改为GenericJackson2JsonRedisSerializer</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisConfig</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Bean</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">myRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">          RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">          template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">          <span class="comment">// Jackson2JsonRedisSerializer&lt;Object&gt; serializer = new Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class);      </span></span><br><span class="line">          GenericJackson2JsonRedisSerializer serializer = <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">          template.setDefaultSerializer(serializer);</span><br><span class="line">          <span class="keyword">return</span> template;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用时自动注入即可<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span> </span><br><span class="line"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; myRedisTemplate</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义RedisCacheManager，使用GenericJackson2JsonRedisSerializer类对value进行序列化</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  <span class="comment">///2.0</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//初始化一个RedisCacheWriter</span></span><br><span class="line">       RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory);</span><br><span class="line">       <span class="comment">//设置CacheManager的值序列化方式为json序列化</span></span><br><span class="line">       RedisSerializer&lt;Object&gt; jsonSerializer = <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">       RedisSerializationContext.SerializationPair&lt;Object&gt; pair = RedisSerializationContext.SerializationPair</span><br><span class="line">               .fromSerializer(jsonSerializer);</span><br><span class="line">       RedisCacheConfiguration defaultCacheConfig = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">               .serializeValuesWith(pair);</span><br><span class="line">       <span class="comment">//设置默认超过期时间是30分钟</span></span><br><span class="line">       defaultCacheConfig.entryTtl(Duration.ofSeconds(<span class="number">30</span> * <span class="number">60</span>));</span><br><span class="line">       <span class="comment">//初始化RedisCacheManager</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> RedisCacheManager(redisCacheWriter, defaultCacheConfig);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>自定义序列化或自定义RedisCacheManager后的数据存入缓存结果如下:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">k:"emp::2"</span></span><br><span class="line"><span class="attr">v:</span> <span class="string">&#123;</span> </span><br><span class="line">   <span class="string">"@class"</span><span class="string">:</span> <span class="string">"person.simon.springboot.entity.Employee"</span><span class="string">,</span> </span><br><span class="line">   <span class="attr">"id":</span> <span class="number">2</span><span class="string">,</span> </span><br><span class="line">   <span class="attr">"lastName":</span> <span class="string">"zhangsan"</span><span class="string">,</span> </span><br><span class="line">   <span class="attr">"email":</span> <span class="string">"test@test.com"</span><span class="string">,</span>  </span><br><span class="line">   <span class="attr">"gender":</span> <span class="number">0</span><span class="string">,</span> </span><br><span class="line">    <span class="attr">"dId":</span> <span class="number">7</span></span><br><span class="line">     <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>==注意==：若使用Jackson2JsonRedisSerializer，序列化的json没有 “@class”: “person.simon.springboot.entity.Employee” ,在读取缓存时会报类型转换异常。所以必须用 GenericJackson2JsonRedisSerializer进行value的序列化解析</p>
<h3 id="五、缓存工作原理"><a href="#五、缓存工作原理" class="headerlink" title="五、缓存工作原理"></a>五、缓存工作原理</h3><ol>
<li>自动配置类：CacheAutoConﬁguration 2. 该自动配置类向容器导入了CacheConﬁgurationImportSelector<ol start="2">
<li>该自动配置类向容器导入了CacheConﬁgurationImportSelector</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import</span>(&#123;CacheAutoConfiguration.CacheConfigurationImportSelector<span class="class">.<span class="keyword">class</span>, </span></span><br><span class="line"><span class="class"><span class="title">CacheAutoConfiguration</span>.<span class="title">CacheManagerEntityManagerFactoryDependsOnPostProc</span> <span class="title">essor</span>.<span class="title">class</span>&#125;) </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">CacheAutoConfiguration</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>该类中有一个selectimports()方法，用于添加缓存的配置类，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GenericCacheConfiguration</span></span><br><span class="line"><span class="comment">  JCacheCacheConfiguration EhCacheCacheConfiguration</span></span><br><span class="line"><span class="comment">   HazelcastCacheConfiguration InfinispanCacheConfiguration</span></span><br><span class="line"><span class="comment">  CouchbaseCacheConfiguration </span></span><br><span class="line"><span class="comment">  RedisCacheConfiguration </span></span><br><span class="line"><span class="comment">  CaffeineCacheConfiguration </span></span><br><span class="line"><span class="comment">  GuavaCacheConfiguration </span></span><br><span class="line"><span class="comment">  SimpleCacheConfiguration（默认生效）</span></span><br><span class="line"><span class="comment">   NoOpCacheConfiguration */</span></span><br><span class="line">  <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;    </span><br><span class="line">      CacheType[] types = CacheType.values();    String[] imports = <span class="keyword">new</span> String[types.length];    </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; types.length; ++i) &#123;        </span><br><span class="line">          imports[i] = CacheConfigurations.getConfigurationClass(types[i]);  &#125;    <span class="keyword">return</span> imports;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>通过进行debug可以得知，添加的配置类中==SimpleCacheConﬁguration是默认生效的==</li>
<li>给容器中注册了一个CacheManager：ConcurrentMapCacheManager</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SimpleCacheConfiguration.class</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function">ConcurrentMapCacheManager <span class="title">cacheManager</span><span class="params">(CacheProperties cacheProperties, CacheManagerCustomizers cacheManagerCustomizers)</span> </span>&#123;    </span><br><span class="line">       ConcurrentMapCacheManager cacheManager = <span class="keyword">new</span> ConcurrentMapCacheManager();    </span><br><span class="line">       List&lt;String&gt; cacheNames = cacheProperties.getCacheNames();    </span><br><span class="line">       <span class="keyword">if</span> (!cacheNames.isEmpty()) &#123;        cacheManager.setCacheNames(cacheNames);  &#125;    </span><br><span class="line">       <span class="keyword">return</span> (ConcurrentMapCacheManager) cacheManagerCustomizers.customize(cacheManag er);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>. 而ConcurrentMapCacheManager实现了CacheManager接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ConcurrentMapCacheManager.class </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentMapCacheManager</span> <span class="keyword">implements</span> <span class="title">CacheManager</span>, </span></span><br><span class="line"><span class="class"><span class="title">BeanClassLoaderAware</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CacheManager.class</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CacheManager</span> </span>&#123;   </span><br><span class="line">  <span class="meta">@Nullable</span>   </span><br><span class="line">   <span class="function">Cache <span class="title">getCache</span><span class="params">(String var1)</span></span>;<span class="comment">//按照一个var1（名字）获得一个缓存    </span></span><br><span class="line">   <span class="function">Collection&lt;String&gt; <span class="title">getCacheNames</span><span class="params">()</span></span>; &#125;</span><br></pre></td></tr></table></figure>
<p>对应的实现getCache（）为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Cache <span class="title">getCache</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    Cache cache = (Cache) <span class="keyword">this</span>.cacheMap.get(name);</span><br><span class="line">    <span class="keyword">if</span> (cache == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.dynamic) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.cacheMap) &#123;</span><br><span class="line">            cache = (Cache) <span class="keyword">this</span>.cacheMap.get(name);<span class="comment">//对应名字去寻找缓存组件    </span></span><br><span class="line">            <span class="keyword">if</span> (cache == <span class="keyword">null</span>) &#123;</span><br><span class="line">                cache = <span class="keyword">this</span>.createConcurrentMapCache(name);<span class="comment">//当缓存组件 为空时，创建缓存组件          </span></span><br><span class="line">                <span class="keyword">this</span>.cacheMap.put(name, cache);<span class="comment">//把新创建的缓存组件加入到缓 存的HashMap中          </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可知ConcurrentMapCacheManager==可以用于获取和创建ConcurrentMapCache类型的缓存组 件==；他的作用是将数据保存在ConcurrentMap中 （以@Cacheable运行流程为例来详细理解ConcurrentMapCacheManager的作用）</p>
<p> <strong>@Cacheable运行流程</strong></p>
<ol>
<li>方法运行之前，查询Cache（缓存组件），按照cacheNames指定的名字来获取； （CacheManager来先获取相应的缓存）</li>
<li>运行getCache（String name）方法<br>●   如果是第一次运行，将不存在“emp”这个缓存组件。所以调用 createConcurrentMapCache（name）这个方法来自动创建缓存。把创建出来的缓存组件 放到cacheMap中。<br>●   如果不是第一次运行，则根据缓存直接从cacheMap中获取数据。</li>
<li>去Cache中查找缓存的内容，使用一个key（默认是方法参数）；key是按照某种策略生成的；默 认是使用keyGenerator生成，而其中默认使用SimplekeyGenerator生成key。 SimplekeyGenerator生成key的默认策略：<br>●  如果没有参数：key = new SimpleKey();<br> ●  如果有一个参数：key = 参数的值;<br>●  如果有多个参数：key = new SimpleKey(params);</li>
<li>●   如果缓存为空（没有查到缓存），就调用目标方法；将目标方法返回的结果放到缓存里<br> ●  如果缓存不为空（查到对应缓存），就不用调用目标方法。直接从缓存中拿出值。  <h6 id="核心："><a href="#核心：" class="headerlink" title="核心："></a>核心：</h6><ol>
<li>使用CacheManager【ConcurrentMapCacheManager】按照名字得到 Cache【ConcurrentMapCache】组件</li>
<li>key使用keyGenerator，默认是SimplekeyGenerator</li>
</ol>
</li>
</ol>
<h2 id="Springboot与消息"><a href="#Springboot与消息" class="headerlink" title="Springboot与消息"></a>Springboot与消息</h2><h3 id="一、消息的简介"><a href="#一、消息的简介" class="headerlink" title="一、消息的简介"></a>一、消息的简介</h3><h5 id="1-消息服务的两个重要概念"><a href="#1-消息服务的两个重要概念" class="headerlink" title="1. 消息服务的两个重要概念"></a>1. 消息服务的两个重要概念</h5><ul>
<li>消息代理（message broker）：相当于消息服务中间件的服务器</li>
<li>目的地（对应相应的消息通信机制）： <ul>
<li><strong>队列（queue）：</strong><ul>
<li>点对点消息通信（point-to-point）：</li>
<li>消息发送者发送消息，消息代理将其放到一个队列中，消息接收者从队列中获取消 息内容，消息读取后即被移出队列。 消息只有唯一的发送者和接受者（获取到消息的人），但并不是说只能有一个接收 者（能拿信息的人）<ul>
<li>也就是说只能一个人发送消息到队列，可以有无限的人获取这个信息，但当 某一个拿到该信息之后，其他人无法再拿该信息 —-生产者–消费者模型</li>
</ul>
</li>
</ul>
</li>
<li>** 主题（topic）：**<ul>
<li>发布（publish）/订阅（subscribe）消息通信：<ul>
<li>发送者（发布者）发送消息到主题，多个接收者（订阅者）监听（订阅）这个主 题，那么就会在消息到达时同时收到消息。<h5 id="2-消息的代理规范"><a href="#2-消息的代理规范" class="headerlink" title="2. 消息的代理规范"></a>2. 消息的代理规范</h5></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>JMS（Java Message Service）</strong><ul>
<li>Java消息服务应用程序接口，是基于JVM消息代理的规范。</li>
<li>ActiveMQ、HornetMQ是JMS的实现 </li>
</ul>
</li>
<li>AMQP（Advanced Message Queuing Protocol）<ul>
<li>一个提供统一消息服务的应用层标准高级消息队列协议，是应用层协议的一个开放标准，为 面向消息的中间件设计。</li>
<li>也是一个消息代理的规范，兼容了JMS。</li>
<li>RabbitMQ是AMQP的实现。<h5 id="3-作用"><a href="#3-作用" class="headerlink" title="3. 作用"></a>3. 作用</h5></li>
</ul>
</li>
<li>应用可通过消息服务中间件来提升系统的异步通信、扩展解耦的能力。</li>
<li>当消息发送者发送消息以后，将由消息代理接管，消息代理保证消息传递到指定的目的地。<h5 id="4-4场景"><a href="#4-4场景" class="headerlink" title="4.4场景"></a>4.4场景</h5></li>
</ul>
<ol>
<li><strong>异步处理</strong></li>
</ol>
<blockquote>
<p>场景：以用户注册为例，注册成功时发送邮件和短信。</p>
</blockquote>
<ul>
<li>把注册信息写入数据库，然后把相关信息写入消息队列，即可响应用户。发送邮件和短信均通 过异步读取消息队列来进行完成。第3个格子）     </li>
<li>这样，就能实现注册与 发送邮件和发送短信 这样的消息处理并行，加快响应速度。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200612193254600.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<ol start="2">
<li><p><strong>应用解耦</strong></p>
<blockquote>
<p>场景：一个应用中的订单系统和库存系统</p>
</blockquote>
<p>订单系统在获取到订单之后，写入消息队列，然后就能继续获取订单了，不用再关心后续的操 作。而库存系统也只需要去订阅消息队列。实现了两个系统之间的解耦。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200612193726681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p><strong>流量削峰</strong></p>
<blockquote>
<p>场景：商品秒杀系统。比如某商品有1万件，有10万人抢购。</p>
</blockquote>
<p>把消息队列规定长度只有1万，用户的请求不进行直接处理，进行入消息队列操作，超过1万之 后，直接响应“抢购失败”。避免了每个用户请求都去查询库存，造成数据库崩溃。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200612193900631.png" alt="在这里插入图片描述"></p>
<h3 id="二、RabbitMQ"><a href="#二、RabbitMQ" class="headerlink" title="二、RabbitMQ"></a>二、RabbitMQ</h3><blockquote>
<p>RabbitMQ是一个由erlang开发的AMQP(Advanved Message Queue Protocol)的开源实现。</p>
<p><strong>核心概念</strong><br><strong>.未完..</strong></p>
</blockquote>
</li>
</ol>
<h2 id="Spring-Boot与分布式"><a href="#Spring-Boot与分布式" class="headerlink" title="Spring Boot与分布式"></a>Spring Boot与分布式</h2><h3 id="一、分布式应用"><a href="#一、分布式应用" class="headerlink" title="一、分布式应用"></a>一、分布式应用</h3><p><strong>在分布式系统中，国内常用zookeeper+dubbo组合，而Spring Boot推荐使用 全栈的Spring，Spring Boot+Spring Cloud。</strong></p>
<blockquote>
<p>eg：可以将用户模块和订单模块分别部署到几个不同的服务器，各个服务器承载不同的并发</p>
</blockquote>
<ul>
<li><p>分布式系统：<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613091208371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p><strong>单一应用架构</strong> </p>
<pre><code>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成 本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。 </code></pre></li>
<li><p><strong>垂直应用架构</strong><br>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干 的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。 </p>
</li>
<li><p><strong>分布式服务架构</strong><br>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服 务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时， 用于提高业务复用及整合的分布式服务框架(RPC)是关键。 </p>
</li>
<li><p><strong>流动计算架构</strong><br>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个 调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利 用率的资源调度和治理中心(SOA)是关键。</p>
<h3 id="二、Zookeeper和Dubbo"><a href="#二、Zookeeper和Dubbo" class="headerlink" title="二、Zookeeper和Dubbo"></a>二、Zookeeper和Dubbo</h3></li>
<li><p><strong>ZooKeeper</strong><br>ZooKeeper 是一个分布式的，开放源码的分布式应用程序协调服务。它是 一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、 域名服务、分布式同步、组服务等。</p>
</li>
<li><p><strong>Dubbo</strong><br>Dubbo是Alibaba开源的分布式服务框架，它最大的特点是按照分层的方 式来架构，使用这种方式可以使各个层之间解耦合（或者最大限度地松耦 合）。从服务模型的角度来看，Dubbo采用的是一种非常简单的模型，要 么是提供方提供服务，要么是消费方消费服务，所以基于这一点可以抽象 出服务提供方（Provider）和服务消费方（Consumer）两个角色。</p>
</li>
<li><p><strong>dubbo架构工作图</strong><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613092327473.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="三、Zookeeper和Dubbo简单使用"><a href="#三、Zookeeper和Dubbo简单使用" class="headerlink" title="三、Zookeeper和Dubbo简单使用"></a>三、Zookeeper和Dubbo简单使用</h3><ol>
<li><p><strong>使用docker装上Zookeeper</strong></p>
<ul>
<li>docker pull Zookeeper      </li>
</ul>
</li>
</ol>
<ul>
<li>docker run –name some-zookeeper –restart always -d zookeeper(容器id)<br>eg :docker run –name zk -p 2181:2181 –restart always -d f0046c64f12e</li>
</ul>
</li>
</ul>
<p>2.<strong>创建工程</strong><br>    1. 创建一个空工程<br>    2. 创建provider-ticket模块<br>       编写接口<br>        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> *         1、将服务提供者注册到注册中心</span></span><br><span class="line"><span class="comment"> * 	        1、引入dubbo和zkclient相关依赖</span></span><br><span class="line"><span class="comment">  * 	    2、配置dubbo的扫描包和注册中心地址</span></span><br><span class="line"><span class="comment">  * 	    3、使用<span class="doctag">@Service</span>发布服务</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">package</span> com.atguigu.ticket.service;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TicketService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTicket</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>        接口实现<br>        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Service</span> <span class="comment">//将服务发布出去</span></span><br><span class="line">	 <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketServiceImpl</span> <span class="keyword">implements</span> <span class="title">TicketService</span> </span>&#123;</span><br><span class="line">			 <span class="meta">@Override</span></span><br><span class="line">			 <span class="function"><span class="keyword">public</span> String <span class="title">getTicket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		     <span class="keyword">return</span> <span class="string">"《厉害了，我的国》"</span>;</span><br><span class="line"> 	    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><br>          其配置文件<br>        <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">dubbo.application.name=provider-ticket</span></span><br><span class="line"><span class="string">dubbo.registry.address=zookeeper://192.168.25.132:2181</span></span><br><span class="line"><span class="string">dubbo.scan.base-packages=com.atguigu.ticket.service</span></span><br></pre></td></tr></table></figure></p>
<pre><code>3. 创建consumer-user模块         
              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 	<span class="keyword">package</span> com.atguigu.user.service;</span><br><span class="line"> 	<span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"> 	<span class="keyword">import</span> com.atguigu.ticket.service.TicketService;</span><br><span class="line"> 	<span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> 		<span class="meta">@Service</span></span><br><span class="line"> 		<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line"> 			<span class="meta">@Reference</span></span><br><span class="line"> 			TicketService ticketService;</span><br><span class="line"> 		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line"> 			String ticket = ticketService.getTicket();</span><br><span class="line">System.out.println(<span class="string">"买到票了："</span>+ticket);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    其配置文件
    ​```yml 
    server.port=8081
    dubbo.application.name=consumer-user
    dubbo.registry.address=zookeeper://192.168.25.132:2181
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">4. 引入zookeeper的客户端工具</span><br><span class="line">       &#96;&#96;&#96;xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.github.sgroschupf&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;zkclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;version&gt;0.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
        5.  将provider-ticket模块模块的TicketService接口放到consumer-user模块         ，必须全类名/包名相同
        6. 编写测试

              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class">//<span class="title">Test</span>包下测试</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ConsumerUserApplicationTests</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	UserService userService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	userService.hello();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
     7. 结果： 
     ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200613122533368.png)</code></pre><h3 id="三、Spring-Boot和Spring-Cloud"><a href="#三、Spring-Boot和Spring-Cloud" class="headerlink" title="三、Spring Boot和Spring Cloud"></a>三、Spring Boot和Spring Cloud</h3><p>  <strong>Spring Cloud</strong></p>
<ul>
<li>Spring Cloud是一个分布式的整体解决方案。Spring Cloud 为开发者提供了==在分布式系统（配 置管理，服务发现，熔断，路由，微代理，控制总线，一次性token，全局琐，leader选举，分 布式session，集群状态）中快速构建的工具==，使用Spring Cloud的开发者可以快速的启动服务 或构建应用、同时能够快速和云平台资源进行对接。</li>
<li>SpringCloud分布式开发五大常用组件<ul>
<li>服务发现——Netflix Eureka <ul>
<li>客服端负载均衡——Netflix Ribbon <ul>
<li>断路器——Netflix Hystrix • 服务网关——Netflix Zuul<ul>
<li>分布式配置——Spring Cloud Config<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613123146948.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-Spring-Cloud-入门"><a href="#1-Spring-Cloud-入门" class="headerlink" title="1. Spring Cloud 入门"></a>1. Spring Cloud 入门</h4><p>1.<strong>创建eureka-server模块</strong><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613123704259.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>创建时勾选eureka service————-注册中心<br>2.<strong>创建proviider-ticker模块r</strong></p>
<p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613123905125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>创建时勾选eureka discovery————-服务注册和发现<br>3. <strong>创建customer-userr模块</strong><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613124128835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>创建时勾选eureka discovery————-服务注册和发现<br>4. <strong>配置</strong></p>
<ul>
<li>eureka-server模块<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka-server</span>  <span class="comment">#eureka实例的主机名</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>  <span class="comment">#不将自己注册到eureka的注册中心</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>  <span class="comment">#不从eureka中心获取信息</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone :</span> <span class="string">http://localhost:8761/eureka</span></span><br></pre></td></tr></table></figure></li>
<li>proviider-ticker模块<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">proviider-ticker</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment">#注册服务时候用服务的ip</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka</span></span><br></pre></td></tr></table></figure></li>
<li>customer-user模块<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">customer-user</span>   <span class="comment">#注册到注册中心的名字</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment">#注册服务时候用服务的ip</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>编写proviider-ticker模块<br>service<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> persionwjy.pticker.service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TickerService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"8001"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;西游记&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
controller</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> persionwjy.pticker.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> persionwjy.pticker.service.TickerService;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TickerController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TickerService tickerService;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/ticket"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicker</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tickerService.getTicker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>到此驱动eureka-server和proviider-ticker测试即可：<br>浏览器输入：<a href="http://localhost:8002/ticket" target="_blank" rel="noopener">http://localhost:8002/ticket</a><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2020061315055411.png" alt="在这里插入图片描述"></li>
<li>proviider-ticker模块打包俩个jar，分别改下打印</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> persionwjy.pticker.service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TickerService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"8001"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;西游记&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> persionwjy.pticker.service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TickerService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"8002"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;西游记&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后用java -jar *** 运行俩个<br> 8. 编写proviider-ticker模块<br> controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> person.wjy.user.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/buy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">buyTicker</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">    <span class="comment">//        PROVIIDER-TICKER --&gt; 请求的服务名</span></span><br><span class="line">   <span class="comment">//       ticket  --&gt; 请求的接口名</span></span><br><span class="line">        String s = restTemplate.getForObject(<span class="string">"http://PROVIIDER-TICKER/ticket"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> name+<span class="string">"购买了"</span>+s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span><span class="comment">//开启发现服务功能</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerUserApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CustomerUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span><span class="comment">//启用负载均衡机制</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问：<a href="http://localhost:8200/buy?name=Tom" target="_blank" rel="noopener">http://localhost:8200/buy?name=Tom</a><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2020061316420345.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613164128709.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="Spring-Boot与监控管理"><a href="#Spring-Boot与监控管理" class="headerlink" title="Spring Boot与监控管理"></a>Spring Boot与监控管理</h2><h3 id="一、监控管理"><a href="#一、监控管理" class="headerlink" title="一、监控管理"></a>一、监控管理</h3><p>通过引入spring-boot-starter-actuator，可以使用Spring Boot为我们提供的准 生产环境下的应用监控和管理功能。我们可以通过HTTP，JMX，SSH协议来进 行操作，自动得到审计、健康及指标信息等</p>
<ul>
<li><p><strong>步骤：</strong><br> – 引入spring-boot-starter-actuator<br> – 通过http方式访问监控端点<br> – 可进行shutdown（POST 提交，此端点默认关闭）</p>
</li>
<li><p><strong>监控和管理端点</strong><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2020061317143961.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>引入依赖</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>启动项目可以看到的监控信息</strong><br>配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.security.enabled=<span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p> <img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2020061317194248.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>*配置info一些信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#git.properties</span><br><span class="line">git.brach=master</span><br><span class="line">git.commit.id=xjkd33s</span><br><span class="line">git.commit.time=<span class="number">2017</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">12</span>:<span class="number">12</span>:<span class="number">56</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#application.properties</span><br><span class="line">management.security.enabled=<span class="keyword">false</span></span><br><span class="line">info.app.id=hello</span><br><span class="line">info.app.version=<span class="number">1.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<p><strong>访问</strong>：localhost:8080/info<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20200613172948688.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>其他就不一 一截图测试</p>
<h3 id="二、定制端点信息"><a href="#二、定制端点信息" class="headerlink" title="二、定制端点信息"></a>二、定制端点信息</h3><p>– 定制端点一般通过endpoints+端点名+属性名来设置。<br>– 修改端点id（<code>endpoints.beans.id=mybeans</code>）<br> – 开启远程应用关闭功能（<code>endpoints.shutdown.enabled=true</code>）<br> – 关闭端点（endpoints.beans.enabled=false）<br> – 开启所需端点<br>   • <code>endpoints.enabled=false</code><br>  • <code>endpoints.beans.enabled=true</code><br> – 定制端点访问根路径<br>      • <code>management.context-path=/manage</code><br> – 关闭http端点<br>  • <code>management.port=-1</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">management.security.enabled=false</span></span><br><span class="line"><span class="string">info.app.id=hello</span></span><br><span class="line"><span class="string">info.app.version=1.0.2</span></span><br><span class="line"><span class="comment">#endpoints.metrics.enabled=false  #禁止访问metrics</span></span><br><span class="line"><span class="comment">#是否能远程关闭</span></span><br><span class="line"><span class="string">endpoints.shutdown.enabled=true</span></span><br><span class="line"><span class="comment">#改变端点的名字</span></span><br><span class="line"><span class="string">endpoints.beans.id=</span> <span class="string">mybean</span></span><br><span class="line"><span class="comment">#定制访问路径</span></span><br><span class="line"><span class="string">endpoints.beans.path=beans</span></span><br><span class="line"><span class="comment">#设置不能访问</span></span><br><span class="line"><span class="comment">#endpoints.beans.enabled=false</span></span><br><span class="line"><span class="comment">#关闭多有端点</span></span><br><span class="line"><span class="comment">#endpoints.enabled=false</span></span><br><span class="line"><span class="comment">#开启个别端点</span></span><br><span class="line"><span class="comment">#endpoints.beans.enabled=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定制根路径</span></span><br><span class="line"><span class="string">management.context-path=/manage</span></span><br><span class="line"><span class="comment">#d端口号    -1表示禁用</span></span><br><span class="line"><span class="string">management.port=</span> <span class="number">8181</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.redis.host=192.168.1.8</span></span><br></pre></td></tr></table></figure>
<h6 id="40、自定义HealthIndicator"><a href="#40、自定义HealthIndicator" class="headerlink" title="40、自定义HealthIndicator"></a>40、自定义HealthIndicator</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/**</span></span><br><span class="line"> <span class="string">*</span> <span class="string">自定义健康状态指示器</span></span><br><span class="line"> <span class="string">*</span> <span class="number">1</span><span class="string">、编写一个指示器</span> <span class="string">实现</span> <span class="string">HealthIndicator</span> <span class="string">接口</span></span><br><span class="line"> <span class="string">*</span> <span class="number">2</span><span class="string">、指示器的名字</span> <span class="string">xxxxHealthIndicator</span></span><br><span class="line"> <span class="string">*</span> <span class="number">3</span><span class="string">、加入容器中</span></span><br><span class="line"> <span class="string">*/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> person.wjy.actuator.health;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.Health;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHealthIndicator</span> <span class="keyword">implements</span> <span class="title">HealthIndicator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Health <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//自定义检查方法</span></span><br><span class="line">        <span class="comment">//return Health.up().build();   //代表健康</span></span><br><span class="line">        <span class="keyword">return</span> Health.down().withDetail(<span class="string">"msg"</span>,<span class="string">"服务异常"</span>).build();   <span class="comment">//代表健康</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1442243445@qq.com">小小王</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/07/16/SpringBoot%E6%95%B4%E5%90%88%E5%90%84%E6%8A%80%E6%9C%AF%E5%92%8C%E6%A1%86%E6%9E%B6/">http://yoursite.com/2020/07/16/SpringBoot%E6%95%B4%E5%90%88%E5%90%84%E6%8A%80%E6%9C%AF%E5%92%8C%E6%A1%86%E6%9E%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Wang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a></div><div class="post_share"><div class="social-share" data-image="/img/bg3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/07/16/SpringCloud%20Stream%20%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"><img class="prev-cover" data-src="/img/bg4.jpg" onerror="onerror=null;src='/'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringCloud Stream 消息驱动</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/16/SpringCloudSleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"><img class="next-cover" data-src="/img/bg4.jpg" onerror="onerror=null;src='/'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringCloudSleuth分布式请求链路跟踪</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/16/springboot核心技术/" title="Spring Boott核心技术"><img class="relatedPosts_cover" data-src="img/bg7.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-16</div><div class="relatedPosts_title">Spring Boott核心技术</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 小小王</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20054751</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="js/move_mouse/script.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/js/pool.min.js"></script><script src="/js/down_mouse/love.js"></script><script src='https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/mouse_snow.min.js'></script></body></html>