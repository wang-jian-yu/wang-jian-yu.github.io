<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDb | Wang</title><meta name="description" content="1、NoSql介绍NoSQL(NoSQL&#x3D;NotOnlySQL)，意即“不仅仅是SQL”，它指的是非关系型的数据库，是以key-value形式存储，和传统的关系型数据库不一样，不一定遵循传统数据库的一些基本要求，比如说遵循SQL标准、ACID属性、表结构等等。NoSQL最早被提出是在20世纪80年代，在当时更多是强调的是与关系数据库区别对待，最近这些年被提及的更多是强调协助解决大数据等相关问题。N"><meta name="keywords" content="MongoDb"><meta name="author" content="小小王,1442243445@qq.com"><meta name="copyright" content="小小王"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/Banq-1.ico"><link rel="canonical" href="http://yoursite.com/2021/01/12/MongoDb/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="MongoDb"><meta property="og:url" content="http://yoursite.com/2021/01/12/MongoDb/"><meta property="og:site_name" content="Wang"><meta property="og:description" content="1、NoSql介绍NoSQL(NoSQL&#x3D;NotOnlySQL)，意即“不仅仅是SQL”，它指的是非关系型的数据库，是以key-value形式存储，和传统的关系型数据库不一样，不一定遵循传统数据库的一些基本要求，比如说遵循SQL标准、ACID属性、表结构等等。NoSQL最早被提出是在20世纪80年代，在当时更多是强调的是与关系数据库区别对待，最近这些年被提及的更多是强调协助解决大数据等相关问题。N"><meta property="og:image" content="http://yoursite.com/img/bg4.jpg"><meta property="article:published_time" content="2021-01-12T03:28:24.000Z"><meta property="article:modified_time" content="2021-06-27T03:34:26.318Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="Http" href="http://yoursite.com/2021/01/14/Http/"><link rel="next" title="NodeJs" href="http://yoursite.com/2021/01/10/NodeJs/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="/css/move_mouse/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/iconfont.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/pool.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">53</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">38</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、NoSql介绍"><span class="toc-number">1.</span> <span class="toc-text">1、NoSql介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#NoSQL数据库在以下的这几种情况下比较适用："><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text">NoSQL数据库在以下的这几种情况下比较适用：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、MongoDb介绍"><span class="toc-number">2.</span> <span class="toc-text">2、MongoDb介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、MongoDb安装"><span class="toc-number">3.</span> <span class="toc-text">3、MongoDb安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、增加数据、查数据"><span class="toc-number">4.</span> <span class="toc-text">4、增加数据、查数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、-修改数据"><span class="toc-number">5.</span> <span class="toc-text">5、 修改数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、删除数据"><span class="toc-number">6.</span> <span class="toc-text">6、删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7、索引基础"><span class="toc-number">7.</span> <span class="toc-text">7、索引基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8、使用explain"><span class="toc-number">8.</span> <span class="toc-text">8、使用explain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9、Mongodb账户权限配置"><span class="toc-number">9.</span> <span class="toc-text">9、Mongodb账户权限配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第一步创建超级管理用户"><span class="toc-number">9.0.1.</span> <span class="toc-text">第一步创建超级管理用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第二步修改Mongodb数据库配置文件"><span class="toc-number">9.0.2.</span> <span class="toc-text">第二步修改Mongodb数据库配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三步重启mongodb服务"><span class="toc-number">9.0.3.</span> <span class="toc-text">第三步重启mongodb服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第四步用超级管理员账户连接数据库"><span class="toc-number">9.0.4.</span> <span class="toc-text">第四步用超级管理员账户连接数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第五步给eggcms数据库创建一个用户只能访问eggcms不能访问其他数据库"><span class="toc-number">9.0.5.</span> <span class="toc-text">第五步给eggcms数据库创建一个用户只能访问eggcms不能访问其他数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mongodb账户权限配置中常用的命令"><span class="toc-number">9.0.6.</span> <span class="toc-text">Mongodb账户权限配置中常用的命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mongodb数据库角色"><span class="toc-number">9.0.7.</span> <span class="toc-text">Mongodb数据库角色</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连接数据库的时候需要配置账户密码"><span class="toc-number">9.0.8.</span> <span class="toc-text">连接数据库的时候需要配置账户密码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10、MongoDB聚合管道"><span class="toc-number">10.</span> <span class="toc-text">10、MongoDB聚合管道</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDBAggregation管道操作符与表达式"><span class="toc-number">10.0.1.</span> <span class="toc-text">MongoDBAggregation管道操作符与表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL和NOSQL对比"><span class="toc-number">10.0.2.</span> <span class="toc-text">SQL和NOSQL对比:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#管道表达式"><span class="toc-number">10.0.3.</span> <span class="toc-text">管道表达式:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#project"><span class="toc-number">10.0.4.</span> <span class="toc-text">$project</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#match"><span class="toc-number">10.0.5.</span> <span class="toc-text">$match</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#group"><span class="toc-number">10.0.6.</span> <span class="toc-text">$group</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sort"><span class="toc-number">10.0.7.</span> <span class="toc-text">$sort</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit"><span class="toc-number">10.0.8.</span> <span class="toc-text">$limit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#skip"><span class="toc-number">10.0.9.</span> <span class="toc-text">$skip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup表关联"><span class="toc-number">10.0.10.</span> <span class="toc-text">$lookup表关联</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/bg4.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Wang</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">MongoDb</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-01-12 11:28:24"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2021-01-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-06-27 11:34:26"><i class="fas fa-history fa-fw"></i> 更新于 2021-06-27</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/MongoDb/">MongoDb</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="1、NoSql介绍"><a href="#1、NoSql介绍" class="headerlink" title="1、NoSql介绍"></a>1、NoSql介绍</h2><p>NoSQL(NoSQL=NotOnlySQL)，意即“<strong>不仅仅是SQL</strong>”，它指的是非关系型的数据库，是以<strong>key-value</strong>形式存储，和传统的关系型数据库不一样，<strong>不一定遵循传统数据库的一些基本要求</strong>，比如说遵循SQL标准、ACID属性、表结构等等。NoSQL最早被提出是在20世纪80年代，在当时更多是强调的是与关系数据库区别对待，最近这些年被提及的更多是强调协助解决大数据等相关问题。<strong>NoSQL在大数据时代有自己的意义。</strong></p>
<h6 id="NoSQL数据库在以下的这几种情况下比较适用："><a href="#NoSQL数据库在以下的这几种情况下比较适用：" class="headerlink" title="NoSQL数据库在以下的这几种情况下比较适用："></a>NoSQL数据库在以下的这几种情况下比较适用：</h6><p>1、数据模型比较简单；<br>2、需要灵活性更强的IT系统；<br>3、对数据库性能要求较高；<br>4、不需要高度的数据一致性；<br>5、对于给定key，比较容易映射复杂值的环境。</p>
<h2 id="2、MongoDb介绍"><a href="#2、MongoDb介绍" class="headerlink" title="2、MongoDb介绍"></a>2、MongoDb介绍</h2><p><strong>MongoDB</strong>是一个介于关系数据库和非关系数据库之间的产品，<strong>是非关系数据库当中功能最丰富，最像关系数据库的NoSql数据库</strong>他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongodb最大的特点是他<strong>支持的查询语言非常强大</strong>，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是<strong>高性能、易部署、易使用，存储数据非常方便。</strong></p>
<h2 id="3、MongoDb安装"><a href="#3、MongoDb安装" class="headerlink" title="3、MongoDb安装"></a>3、MongoDb安装</h2><ul>
<li><a href="https://www.mongodb.com/" target="_blank" rel="noopener">官网</a><br><a href="https://docs.mongodb.org/manual/" target="_blank" rel="noopener">手册</a><br><a href="https://www.mongodb.com/download-center/community" target="_blank" rel="noopener">下载</a></li>
<li>安装完成配置环境变量C:\ProgramFiles\MongoDB\Server\4.2\bin加入到系统的path环境变量中</li>
<li>安装完成后直接运行mongo命令就可以连上mongod数据库。</li>
<li>.打开cmd输入：mongo命令看看是否成功。如果出来下图说明mongodb配置成功。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210327184730382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h2 id="4、增加数据、查数据"><a href="#4、增加数据、查数据" class="headerlink" title="4、增加数据、查数据"></a>4、增加数据、查数据</h2></li>
</ul>
<ol>
<li><p>连接数据库</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">无密码连接</span><br><span class="line">mongo</span><br></pre></td></tr></table></figure></li>
<li><p>查看所有数据库列表</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showdbs</span><br></pre></td></tr></table></figure></li>
<li><p>使用数据库、创建数据库</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use itying</span><br></pre></td></tr></table></figure></li>
<li><p>显示当前的数据集合（mysql中叫表）</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showcollections</span><br></pre></td></tr></table></figure></li>
<li><p>插入数据</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.表名.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangsan"</span>，<span class="string">"age"</span>:20&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>删除集合，删除指定的集合删除表</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase();</span><br></pre></td></tr></table></figure></li>
<li><p>查询去掉后的当前聚集集合中的某列的重复数据</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.distinct(<span class="string">"name"</span>);</span><br><span class="line">会过滤掉name中的相同数据</span><br><span class="line">相当于：selectdistictnamefromuser;</span><br></pre></td></tr></table></figure></li>
<li><p>查询age=22的记录</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;<span class="string">"age"</span>:22&#125;);</span><br><span class="line">相当于：select * from user <span class="built_in">where</span> age=22;</span><br></pre></td></tr></table></figure></li>
<li><p>查询age&gt;22的记录</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$gt</span>:22&#125;&#125;);</span><br><span class="line">相当于：select * from user <span class="built_in">where</span> age&gt;22;</span><br></pre></td></tr></table></figure></li>
<li><p>查询age&lt;22的记录 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$lt</span>:22&#125;&#125;);</span><br><span class="line">相当于：select * from user <span class="built_in">where</span> age&lt;22;</span><br></pre></td></tr></table></figure></li>
<li><p>查询age&gt;=25的记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$gte</span>:25&#125;&#125;);</span><br><span class="line">相当于：select * from user <span class="built_in">where</span> age&gt;=25;</span><br></pre></td></tr></table></figure></li>
<li><p>查询age&lt;=25的记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$lte</span>:25&#125;&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>查询age&gt;=23并且age&lt;=26    <code>注意书写格式</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$gte</span>:23,<span class="variable">$lte</span>:26&#125;&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>查询name中包含mongo的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;name:/mongo/&#125;);</span><br><span class="line">//相当于%%</span><br><span class="line">select * from user <span class="built_in">where</span> name lik e‘%mongo%’;</span><br></pre></td></tr></table></figure></li>
<li><p>1查询name中以mongo开头的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;name:/^mongo/&#125;);</span><br><span class="line">select * from user <span class="built_in">where</span> name like ‘mongo%’;</span><br></pre></td></tr></table></figure></li>
<li><p>查询指定列name、age数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;&#125;,&#123;name:1,age:1&#125;);</span><br><span class="line">相当于：selectname,agefromuser;</span><br><span class="line">当然name也可以用<span class="literal">true</span>或<span class="literal">false</span>,当用ture的情况下河name:1效果一样，如果用<span class="literal">false</span>就</span><br><span class="line">是排除name，显示name以外的列信息。</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询指定列name、age数据,age&gt;25</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$gt</span>:25&#125;&#125;,&#123;name:1,age:1&#125;);</span><br><span class="line">相当于：select name, age from user <span class="built_in">where</span> age&gt;25;</span><br></pre></td></tr></table></figure>
</li>
<li><p>按照年龄排序1升序-1降序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">升序：</span><br><span class="line">db.user.find().sort(&#123;age:1&#125;);</span><br><span class="line">降序：</span><br><span class="line">db.user.find().sort(&#123;age:-1&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询name=zhangsan,age=22的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;name:<span class="string">'zhangsan'</span>,age:22&#125;);</span><br><span class="line">相当于：select * from user <span class="built_in">where</span> name = ‘zhangsan’ and age=‘22’;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询前5条数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().<span class="built_in">limit</span>(5);</span><br><span class="line">相当于：select top 5 * from user;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询10条以后的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().skip(10);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询在5-10之间的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().<span class="built_in">limit</span>(10).skip(5);</span><br><span class="line">可用于分页，<span class="built_in">limit</span>是pageSize，skip是(page-1)*pageSize</span><br></pre></td></tr></table></figure>
</li>
<li><p>or与查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;<span class="variable">$or</span>:[&#123;age:22&#125;,&#123;age:25&#125;]&#125;);</span><br><span class="line">相当于：select * from user <span class="built_in">where</span> age=22 or age=25;</span><br></pre></td></tr></table></figure>
</li>
<li><p>findOne查询第一条数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.findOne();</span><br><span class="line">相当于：select top 1 * fromuser;</span><br><span class="line">db.user.find().<span class="built_in">limit</span>(1);</span><br></pre></td></tr></table></figure></li>
<li><p>查询某个结果集的记录条数统计数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age:&#123;<span class="variable">$gte</span>:25&#125;&#125;).count();</span><br><span class="line">相当于：select count(*) from user <span class="built_in">where</span> age&gt;=20;</span><br><span class="line">如果要返回限制之后的记录数量，要使用count(<span class="literal">true</span>)或者count(非0)</span><br><span class="line">db.users.find().skip(10).<span class="built_in">limit</span>(5).count(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h2 id="5、-修改数据"><a href="#5、-修改数据" class="headerlink" title="5、 修改数据"></a>5、 修改数据</h2></li>
<li><p>修改里面还有查询条件。你要该谁，要告诉mongo。查找名字叫做小明的，把年龄更改为16岁：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;<span class="string">"name"</span>:<span class="string">"小明"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">"age"</span>:16&#125;&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找数学成绩是70，把年龄更改为33岁：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;<span class="string">"score.shuxue"</span>:70&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">"age"</span>:33&#125;&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>更改所有匹配项目：”</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;<span class="string">"sex"</span>:<span class="string">"男"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">"age"</span>:33&#125;&#125;,&#123;multi:<span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>完整替换，不出现$set关键字了：注意</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;<span class="string">"name"</span>:<span class="string">"小明"</span>&#125;,&#123;<span class="string">"name"</span>:<span class="string">"大明"</span>,<span class="string">"age"</span>:16&#125;);</span><br><span class="line">db.users.update(&#123;name:<span class="string">'Lisi'</span>&#125;,&#123;<span class="variable">$inc</span>:&#123;age:50&#125;&#125;,<span class="literal">false</span>,<span class="literal">true</span>);</span><br><span class="line">相当于：update users <span class="built_in">set</span> age = age+5 0where name = ‘Lisi’;</span><br><span class="line">db.users.update(&#123;name:<span class="string">'Lisi'</span>&#125;,&#123;<span class="variable">$inc</span>:&#123;age:50&#125;,<span class="variable">$set</span>:&#123;name:<span class="string">'hoho'</span>&#125;&#125;,<span class="literal">false</span>,<span class="literal">true</span>);</span><br><span class="line">相当于：update users <span class="built_in">set</span> age = age+50, name = ‘hoho’ <span class="built_in">where</span> name = ‘Lisi’;</span><br></pre></td></tr></table></figure>
<h2 id="6、删除数据"><a href="#6、删除数据" class="headerlink" title="6、删除数据"></a>6、删除数据</h2></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.remove(&#123;age:132&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="7、索引基础"><a href="#7、索引基础" class="headerlink" title="7、索引基础"></a>7、索引基础</h2><p><strong>索引</strong>是对数据库表中一列或多列的值进行排序的一种结构，可以让我们查询数据库变得<br>更快。MongoDB的索引几乎与传统的关系型数据库一模一样，这其中也包括一些基本的查询优化技巧。</p>
<ol>
<li><p><strong>下面是创建索引的命令：</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;<span class="string">"userame"</span>:1&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取当前集合的索引：</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.getIndexes()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除索引的命令是：</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropIndex(&#123;<span class="string">"username"</span>:1&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>在MongoDB中，我们同样可以<code>创建复合索引</code>，如：</strong></p>
<ol start="4">
<li><p><strong>数字1表示username键的索引按升序存储，-1表示age键的索引按照降序方式存储。</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;<span class="string">"username"</span>:1,<span class="string">"age"</span>:-1&#125;)</span><br></pre></td></tr></table></figure>
<p> 该索引被创建后，基于username和age的查询将会用到该索引，或者是基于username的查询也会用到该索引，<strong>但是只是基于age的查询将不会用到该复合索引。因此可以说，如果想用到复合索引，必须在查询条件中包含复合索引中的前N个索引列</strong>。然而如果查询条件中的键值顺序和复合索引中的创建顺序不一致的话，MongoDB可以智能的帮助我们调整该顺序，以便使复合索引可以为查询所用。如：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;<span class="string">"age"</span>:30,<span class="string">"username"</span>:<span class="string">"stephen"</span>&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>对于上面示例中的查询条件，MongoDB在检索之前将会动态的调整查询条件文档的顺序，以使该查询可以用到刚刚创建的复合索引。</p>
</li>
<li><p>对于上面创建的索引，MongoDB都会根据索引的keyname和索引方向为新创建的索引自动分配一个索引名，<strong>下面的命令可以在创建索引时为其指定索引名</strong>，如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;<span class="string">"username"</span>:1&#125;,&#123;<span class="string">"name"</span>:<span class="string">"userindex"</span>&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong><font  color=#DC143C>随着集合的增长，需要针对查询中大量的排序做索引。如果没有对索引的键调用sort，MongoDB需要将所有数据提取到内存并排序。因此在做无索引排序时，如果数据量过大以致无法在内存中进行排序，此时MongoDB将会报错。<br></font ></strong></p>
<ol start="5">
<li><p><strong>唯一索引</strong></p>
<ul>
<li><p>在缺省情况下创建的索引均不是唯一索引。下面的示例将创建唯一索引，如：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;<span class="string">"userid"</span>:1&#125;,&#123;<span class="string">"unique"</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果再次插入userid重复的文档时，MongoDB将报错，以提示插入重复键，如：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;<span class="string">"userid"</span>:5&#125;)</span><br><span class="line">db.user.insert(&#123;<span class="string">"userid"</span>:5&#125;) </span><br><span class="line">报错</span><br><span class="line">E11000duplicatekeyerrorindex:user.user.<span class="variable">$userid_1dupkey</span>:&#123;:5.0&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果插入的文档中不包含userid键，那么该文档中该键的值为null，如果多次插入类似的文档，MongoDB将会报出同样的错误，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;<span class="string">"userid1"</span>:5&#125;)</span><br><span class="line">db.user.insert(&#123;<span class="string">"userid1"</span>:5&#125;)</span><br><span class="line">报错</span><br><span class="line">E11000duplicatekeyerrorindex:user.user.<span class="variable">$userid_1dupkey</span>:&#123;:null&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol start="4">
<li><p>如果在创建唯一索引时已经存在了重复项，我们可以通过下面的命令帮助我们在创建唯<br>索引时消除重复文档，仅保留发现的第一个文档，如：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	先删除刚刚创建的唯一索引。</span><br><span class="line">db.user.dropIndex(&#123;<span class="string">"userid"</span>:1&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>插入测试数据，以保证集合中有重复键存在。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove()</span><br><span class="line">db.user.insert(&#123;<span class="string">"userid"</span>:5&#125;)</span><br><span class="line">db.user.insert(&#123;<span class="string">"userid"</span>:5&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新创建唯一索引</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;<span class="string">"userid"</span>:1&#125;,&#123;<span class="string">"unique"</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>我们同样可以创建复合唯一索引，即保证复合键值唯一即可。如：</li>
</ol>
</li>
</ol>
</li>
</ol>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;<span class="string">"userid"</span>:1,<span class="string">"age"</span>:1&#125;,&#123;<span class="string">"unique"</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure></code></pre><h2 id="8、使用explain"><a href="#8、使用explain" class="headerlink" title="8、使用explain"></a>8、使用explain</h2><p>explain是非常有用的工具，会帮助你获得查询方面诸多有用的信息。只要对游标调用<br>该方法，就可以得到查询细节。explain会返回一个文档，而不是游标本身。如：</p>
<ul>
<li>explainexecutionStats查询具体的执行时间  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.tablename.find().explain(<span class="string">"executionStats"</span>)</span><br><span class="line">关注输出的如下数值：explain.executionStats.executionTimeMillis</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="9、Mongodb账户权限配置"><a href="#9、Mongodb账户权限配置" class="headerlink" title="9、Mongodb账户权限配置"></a>9、Mongodb账户权限配置</h2><h4 id="第一步创建超级管理用户"><a href="#第一步创建超级管理用户" class="headerlink" title="第一步创建超级管理用户"></a>第一步创建超级管理用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useadmin</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">user:</span><br><span class="line"><span class="string">'admin'</span>,</span><br><span class="line"><span class="built_in">pwd</span>:<span class="string">'123456'</span>,</span><br><span class="line">roles:[&#123;role:<span class="string">'root'</span>,db:<span class="string">'admin'</span>&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="第二步修改Mongodb数据库配置文件"><a href="#第二步修改Mongodb数据库配置文件" class="headerlink" title="第二步修改Mongodb数据库配置文件"></a>第二步修改Mongodb数据库配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">路径：C:\ProgramFiles\MongoDB\Server\4.0\bin\mongod.cfg</span><br><span class="line">配置：</span><br><span class="line">security:</span><br><span class="line">    authorization:enabled</span><br></pre></td></tr></table></figure>
<h4 id="第三步重启mongodb服务"><a href="#第三步重启mongodb服务" class="headerlink" title="第三步重启mongodb服务"></a>第三步重启mongodb服务</h4><p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2021032721245247.png" alt="在这里插入图片描述"></p>
<h4 id="第四步用超级管理员账户连接数据库"><a href="#第四步用超级管理员账户连接数据库" class="headerlink" title="第四步用超级管理员账户连接数据库"></a>第四步用超级管理员账户连接数据库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongoadmin-u用户名-p密码</span><br><span class="line">mongo192.168.1.200:27017/<span class="built_in">test</span>-uuser-ppassword</span><br></pre></td></tr></table></figure>

<h4 id="第五步给eggcms数据库创建一个用户只能访问eggcms不能访问其他数据库"><a href="#第五步给eggcms数据库创建一个用户只能访问eggcms不能访问其他数据库" class="headerlink" title="第五步给eggcms数据库创建一个用户只能访问eggcms不能访问其他数据库"></a>第五步给eggcms数据库创建一个用户只能访问eggcms不能访问其他数据库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">useeggcms</span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user:</span><br><span class="line"><span class="string">"eggadmin"</span>,</span><br><span class="line"><span class="built_in">pwd</span>:<span class="string">"123456"</span>,</span><br><span class="line">roles:[&#123;role:<span class="string">"dbOwner"</span>,db:<span class="string">"eggcms"</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="Mongodb账户权限配置中常用的命令"><a href="#Mongodb账户权限配置中常用的命令" class="headerlink" title="Mongodb账户权限配置中常用的命令"></a>Mongodb账户权限配置中常用的命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、showusers;</span><br><span class="line"><span class="comment">#查看当前库下的用户</span></span><br><span class="line">2、db.dropUser(<span class="string">"eggadmin"</span>)</span><br><span class="line"><span class="comment">#删除用户</span></span><br><span class="line">3、db.updateUser(<span class="string">"admin"</span>,&#123;<span class="built_in">pwd</span>:<span class="string">"password"</span>&#125;);</span><br><span class="line"><span class="comment">#修改用户密码</span></span><br><span class="line">4、db.auth(<span class="string">"admin"</span>,<span class="string">"password"</span>);</span><br><span class="line"><span class="comment">#密码认证</span></span><br></pre></td></tr></table></figure>
<h4 id="Mongodb数据库角色"><a href="#Mongodb数据库角色" class="headerlink" title="Mongodb数据库角色"></a>Mongodb数据库角色</h4><blockquote>
<p>1.数据库用户角色：read、readWrite;<br>2.数据库管理角色：dbAdmin、dbOwner、userAdmin；<br>3.集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；<br>4.备份恢复角色：backup、restore；<br>5.所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、<br>dbAdminAnyDatabase<br>6.超级用户角色：root<br>参考：<a href="https://www.cnblogs.com/zzw1787044/p/5773178.html" target="_blank" rel="noopener">https://www.cnblogs.com/zzw1787044/p/5773178.html</a></p>
</blockquote>
<h4 id="连接数据库的时候需要配置账户密码"><a href="#连接数据库的时候需要配置账户密码" class="headerlink" title="连接数据库的时候需要配置账户密码"></a>连接数据库的时候需要配置账户密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consturl=<span class="string">'mongodb://admin:123456@localhost:27017/'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="10、MongoDB聚合管道"><a href="#10、MongoDB聚合管道" class="headerlink" title="10、MongoDB聚合管道"></a>10、MongoDB聚合管道</h2><h4 id="MongoDBAggregation管道操作符与表达式"><a href="#MongoDBAggregation管道操作符与表达式" class="headerlink" title="MongoDBAggregation管道操作符与表达式"></a>MongoDBAggregation管道操作符与表达式</h4><p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210327213352230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="SQL和NOSQL对比"><a href="#SQL和NOSQL对比" class="headerlink" title="SQL和NOSQL对比:"></a>SQL和NOSQL对比:</h4><p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210327213415969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="管道表达式"><a href="#管道表达式" class="headerlink" title="管道表达式:"></a>管道表达式:</h4><ul>
<li><p>管道操作符作为“键”,所对应的“值”叫做管道表达式。</p>
<p>  例如{$match:{status:”A”}}，$match称为管道操作符，而status:”A”称为管道表达式，是管道操作符的操作数(Operand)。</p>
</li>
<li><p>每个管道表达式是一个文档结构，它是由字段名、字段值、和一些表达式操作符组成的。</p>
</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210327213525896.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzODE3MTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="project"><a href="#project" class="headerlink" title="$project"></a>$project</h4><ul>
<li><p>要求查找order只返回文档中trade_no和all_price字段</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$project</span>:&#123;trade_no:1,all_price:1&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h4 id="match"><a href="#match" class="headerlink" title="$match"></a>$match</h4></li>
<li><p>用于过滤文档。用法类似于find()方法中的参数</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$project</span>:&#123;trade_no:1,all_price:1&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$match</span>:&#123;<span class="string">"all_price"</span>:&#123;<span class="variable">$gte</span>:90&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h4 id="group"><a href="#group" class="headerlink" title="$group"></a>$group</h4></li>
<li><p>将集合中的文档进行分组，可用于统计结果。<br>统计每个订单的订单数量，按照订单号分组</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.order_item.aggregate(</span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$group</span>:&#123;_id:<span class="string">"<span class="variable">$order_id</span>"</span>,total:&#123;<span class="variable">$sum</span>:<span class="string">"<span class="variable">$num</span>"</span>&#125;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="sort"><a href="#sort" class="headerlink" title="$sort"></a>$sort</h4></li>
<li><p>将集合中的文档进行排序。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$project</span>:&#123;trade_no:1,all_price:1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$match</span>:&#123;<span class="string">"all_price"</span>:&#123;<span class="variable">$gte</span>:90&#125;&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$sort</span>:&#123;<span class="string">"all_price"</span>:-1&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h4 id="limit"><a href="#limit" class="headerlink" title="$limit"></a>$limit</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$project</span>:&#123;trade_no:1,all_price:1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$match</span>:&#123;<span class="string">"all_price"</span>:&#123;<span class="variable">$gte</span>:90&#125;&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$sort</span>:&#123;<span class="string">"all_price"</span>:-1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$limit</span>:1</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h4 id="skip"><a href="#skip" class="headerlink" title="$skip"></a>$skip</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$project</span>:&#123;trade_no:1,all_price:1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$match</span>:&#123;<span class="string">"all_price"</span>:&#123;<span class="variable">$gte</span>:90&#125;&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$sort</span>:&#123;<span class="string">"all_price"</span>:-1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="variable">$skip</span>:1</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h4 id="lookup表关联"><a href="#lookup表关联" class="headerlink" title="$lookup表关联"></a>$lookup表关联</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$lookup</span>:</span><br><span class="line">	&#123;</span><br><span class="line">	from:<span class="string">"order</span></span><br><span class="line"><span class="string">	localField:"</span>order</span><br><span class="line">	foreignField:<span class="string">"order_id"</span>,</span><br><span class="line">	as:<span class="string">"items"</span></span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$lookup</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		from:<span class="string">"order_item"</span>,</span><br><span class="line">		localField:<span class="string">"order_id"</span>,</span><br><span class="line">		foreignField:<span class="string">"order_id"</span>,</span><br><span class="line">		as:<span class="string">"items"</span></span><br><span class="line">	&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$match</span>:&#123;<span class="string">"all_price"</span>:&#123;<span class="variable">$gte</span>:90&#125;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$lookup</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		from:<span class="string">"order_item"</span>,</span><br><span class="line">		localField:<span class="string">"order_id"</span>,</span><br><span class="line">		foreignField:<span class="string">"order_id"</span>,</span><br><span class="line">		as:<span class="string">"items"</span></span><br><span class="line">	&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$project</span>:&#123;trade_no:1,all_price:1,items:1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$match</span>:&#123;<span class="string">"all_price"</span>:&#123;<span class="variable">$gte</span>:90&#125;&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$sort</span>:&#123;<span class="string">"all_price"</span>:-1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1442243445@qq.com">小小王</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/01/12/MongoDb/">http://yoursite.com/2021/01/12/MongoDb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Wang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MongoDb/">MongoDb</a></div><div class="post_share"><div class="social-share" data-image="/img/bg4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/01/14/Http/"><img class="prev-cover" data-src="/img/bg8.jpg" onerror="onerror=null;src='/'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Http</div></div></a></div><div class="next-post pull-right"><a href="/2021/01/10/NodeJs/"><img class="next-cover" data-src="/img/bg8.jpg" onerror="onerror=null;src='/'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">NodeJs</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 小小王</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20054751</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="js/move_mouse/script.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/js/pool.min.js"></script><script src="/js/down_mouse/love.js"></script></body></html>